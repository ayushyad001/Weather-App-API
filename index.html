<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>World Weather ‚Ä¢ Live</title>

  <!-- Map (Leaflet) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root{
      --bg0:#070a12;
      --bg1:#0b1220;
      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.10);
      --text:#eaf0ff;
      --muted: rgba(234,240,255,.70);
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --r: 22px;
      --r2: 16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(56,189,248,.20), transparent 55%),
        radial-gradient(900px 600px at 85% 20%, rgba(168,85,247,.20), transparent 55%),
        radial-gradient(900px 600px at 40% 90%, rgba(34,197,94,.12), transparent 50%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* soft animated blobs */
    .blob{
      position:fixed;
      width:520px; height:520px;
      filter: blur(50px);
      opacity:.35;
      z-index:-1;
      border-radius: 50%;
      animation: floaty 10s ease-in-out infinite;
      pointer-events:none;
    }
    .b1{left:-140px; top:-140px; background: radial-gradient(circle at 30% 30%, rgba(56,189,248,.9), transparent 60%);}
    .b2{right:-160px; top:-120px; background: radial-gradient(circle at 40% 40%, rgba(168,85,247,.85), transparent 60%); animation-duration: 12s;}
    .b3{left:20%; bottom:-220px; background: radial-gradient(circle at 35% 35%, rgba(34,197,94,.70), transparent 60%); animation-duration: 14s;}
    @keyframes floaty{
      0%,100%{transform: translate(0,0) scale(1)}
      50%{transform: translate(18px, -12px) scale(1.03)}
    }

    .wrap{
      width:min(1220px, 100%);
      margin:0 auto;
      padding:18px;
      display:grid;
      gap:14px;
      grid-template-columns: 1.35fr 0.65fr;
    }

    header{
      grid-column: 1 / -1;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      padding: 6px 2px 0;
    }

    .title{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .badge{
      width:44px; height:44px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(56,189,248,.35), rgba(168,85,247,.25));
      border:1px solid var(--stroke);
      display:grid;
      place-items:center;
      box-shadow: var(--shadow);
    }
    h1{margin:0; font-size:30px; letter-spacing:.2px}
    .sub{margin:6px 0 0; color:var(--muted); font-size:13px}

    .topActions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pillBtn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 999px;
      padding:10px 12px;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }
    .pillBtn:hover{background: rgba(255,255,255,.10)}
    .pillBtn:active{transform: translateY(1px)}
    .pillBtn small{color:var(--muted)}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .mapCard{padding:12px}
    #map{
      height: 70vh;
      border-radius: var(--r);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }

    .controls{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .searchWrap{
      flex:1;
      display:flex;
      gap:10px;
      min-width: 240px;
    }
    input{
      flex:1;
      padding:12px 14px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      transition: border-color .2s ease, background .2s ease;
    }
    input:focus{border-color: rgba(56,189,248,.45); background: rgba(0,0,0,.24)}
    input::placeholder{color: rgba(234,240,255,.50)}

    .btn{
      padding:12px 14px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);
      color:var(--text);
      cursor:pointer;
      transition: background .2s ease, transform .08s ease;
      white-space:nowrap;
    }
    .btn:hover{background: rgba(255,255,255,.12)}
    .btn:active{transform: translateY(1px)}

    .status{
      margin-top:10px;
      color: var(--muted);
      min-height:18px;
      font-size: 13px;
    }

    .right{
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .placeRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .placeRow h2{margin:0; font-size:18px}
    .meta{color:var(--muted); font-size:12px; margin-top:4px}

    .hero{
      display:flex;
      gap:12px;
      align-items:center;
      padding:14px;
      border-radius: var(--r2);
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      position:relative;
      overflow:hidden;
    }
    .hero::after{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(600px 200px at 10% 0%, rgba(56,189,248,.22), transparent 50%),
                  radial-gradient(500px 240px at 90% 20%, rgba(168,85,247,.18), transparent 55%);
      opacity:.7;
      pointer-events:none;
    }
    .hero > *{position:relative; z-index:1}

    .icon{
      width:54px; height:54px;
      border-radius: 18px;
      display:grid;
      place-items:center;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.07);
      font-size: 28px;
    }
    .temp{
      font-size: 34px;
      font-weight: 900;
      letter-spacing: -0.4px;
      line-height: 1.05;
    }
    .desc{color:var(--muted); margin-top:2px; font-size: 13px}

    .stats{
      display:grid;
      grid-template-columns:repeat(3, minmax(0, 1fr));
      gap:10px;
    }
    .stat{
      border:1px solid var(--stroke);
      border-radius: var(--r2);
      padding:10px;
      background: rgba(0,0,0,.16);
    }
    .label{color:var(--muted); font-size:12px}
    .value{margin-top:6px; font-size:14px; font-weight:800}

    .chips{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .chip{
      border:1px solid var(--stroke);
      border-radius: 999px;
      padding:8px 10px;
      font-size:12px;
      color:var(--muted);
      background: rgba(255,255,255,.05);
      cursor:pointer;
      transition: background .2s ease;
      user-select:none;
    }
    .chip:hover{background: rgba(255,255,255,.10)}

    .forecastTitle{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-top: 2px;
    }
    .forecastTitle h3{
      margin:0;
      font-size: 13px;
      color: var(--muted);
      font-weight: 800;
      letter-spacing: .3px;
      text-transform: uppercase;
    }

    .forecastGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
      margin-top:10px;
    }
    .day{
      border:1px solid var(--stroke);
      border-radius: var(--r2);
      padding:10px;
      background: rgba(0,0,0,.16);
      transition: transform .12s ease, background .2s ease;
    }
    .day:hover{transform: translateY(-2px); background: rgba(255,255,255,.06)}
    .dtop{display:flex; justify-content:space-between; gap:8px; align-items:baseline}
    .dname{font-weight: 900}
    .ddate{color:var(--muted); font-size:12px}
    .drow{display:flex; gap:8px; align-items:center; margin-top:8px}
    .dicon{font-size:18px}
    .dtext{color:var(--muted); font-size:12px; line-height:1.2}
    .pills{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .pill{
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:4px 8px;
      font-size:12px;
      background: rgba(255,255,255,.06);
      color: var(--text);
    }

    .skeleton{
      position:relative;
      overflow:hidden;
    }
    .skeleton::before{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
      transform: translateX(-100%);
      animation: shimmer 1.1s infinite;
    }
    @keyframes shimmer { 100% { transform: translateX(100%); } }

    /* Leaflet dark polish */
    .leaflet-control-zoom a{
      background: rgba(0,0,0,.35) !important;
      color: var(--text) !important;
      border-color: rgba(255,255,255,.10) !important;
      backdrop-filter: blur(10px);
    }
    .leaflet-control-attribution{
      background: rgba(0,0,0,.35) !important;
      color: rgba(234,240,255,.70) !important;
      border-radius: 12px !important;
      border: 1px solid rgba(255,255,255,.08) !important;
      padding: 2px 8px !important;
      backdrop-filter: blur(10px);
    }

    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr}
      #map{height: 54vh}
      .forecastGrid{grid-template-columns: repeat(3, minmax(0,1fr))}
    }
    @media (max-width: 640px){
      .forecastGrid{grid-template-columns: repeat(2, minmax(0,1fr))}
    }
  </style>
</head>
<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>

  <div class="wrap">
    <header>
      <div>
        <div class="title">
          <div class="badge">üåç</div>
          <div>
            <h1>World Weather</h1>
            <div class="sub">Click anywhere on map or search a city ‚Ä¢ Live weather + 7-day forecast</div>
          </div>
        </div>
      </div>

      <div class="topActions">
        <div class="pillBtn" id="unitBtn" title="Toggle ¬∞C / ¬∞F">
          <span>üå°Ô∏è</span>
          <div><strong id="unitLabel">¬∞C</strong> <small>toggle</small></div>
        </div>
        <button class="pillBtn" id="locBtn" title="Use your current location">
          üìç <div><strong>My location</strong> <small>GPS</small></div>
        </button>
      </div>
    </header>

    <section class="card mapCard">
      <div id="map"></div>

      <div class="controls">
        <div class="searchWrap">
          <input id="cityInput" type="text" placeholder="Search city (e.g., Delhi, Tokyo, New York)" />
          <button class="btn" id="searchBtn">Search</button>
        </div>
        <button class="btn" id="clearBtn">Clear</button>
      </div>

      <div class="status" id="status">Tip: Map pe click karo ‚Äî us location ka weather instantly aayega.</div>
    </section>

    <aside class="card right">
      <div class="placeRow">
        <div>
          <h2 id="placeName">‚Äî</h2>
          <div class="meta" id="updatedAt">Click on map / search a city.</div>
        </div>
        <div class="meta" id="tzNow">‚Äî</div>
      </div>

      <div class="hero" id="heroBox">
        <div class="icon" id="weatherIcon">üåç</div>
        <div>
          <div class="temp" id="tempNow">‚Äî¬∞</div>
          <div class="desc" id="weatherText">‚Äî</div>
        </div>
      </div>

      <div class="stats">
        <div class="stat" id="statHum">
          <div class="label">Humidity</div>
          <div class="value" id="humidityNow">‚Äî%</div>
        </div>
        <div class="stat" id="statWind">
          <div class="label">Wind</div>
          <div class="value" id="windNow">‚Äî km/h</div>
        </div>
        <div class="stat" id="statCoords">
          <div class="label">Coords</div>
          <div class="value" id="coordsNow">‚Äî</div>
        </div>
      </div>

      <div>
        <div class="forecastTitle">
          <h3>Recent searches</h3>
        </div>
        <div class="chips" id="recentChips"></div>
      </div>

      <div>
        <div class="forecastTitle">
          <h3>7-day forecast</h3>
        </div>
        <div class="forecastGrid" id="forecastGrid"></div>
      </div>
    </aside>
  </div>

  <script>
    // ---------- Weather code map (WMO / Open-Meteo) ----------
    const WMO = {
      0:{text:"Clear sky",icon:"‚òÄÔ∏è"},
      1:{text:"Mainly clear",icon:"üå§Ô∏è"},
      2:{text:"Partly cloudy",icon:"‚õÖ"},
      3:{text:"Overcast",icon:"‚òÅÔ∏è"},
      45:{text:"Fog",icon:"üå´Ô∏è"},
      48:{text:"Rime fog",icon:"üå´Ô∏è"},
      51:{text:"Light drizzle",icon:"üå¶Ô∏è"},
      53:{text:"Drizzle",icon:"üå¶Ô∏è"},
      55:{text:"Dense drizzle",icon:"üåßÔ∏è"},
      56:{text:"Freezing drizzle",icon:"üßäüåßÔ∏è"},
      57:{text:"Freezing drizzle",icon:"üßäüåßÔ∏è"},
      61:{text:"Slight rain",icon:"üåßÔ∏è"},
      63:{text:"Rain",icon:"üåßÔ∏è"},
      65:{text:"Heavy rain",icon:"üåßÔ∏è"},
      66:{text:"Freezing rain",icon:"üßäüåßÔ∏è"},
      67:{text:"Freezing rain",icon:"üßäüåßÔ∏è"},
      71:{text:"Slight snow",icon:"üå®Ô∏è"},
      73:{text:"Snow",icon:"üå®Ô∏è"},
      75:{text:"Heavy snow",icon:"‚ùÑÔ∏è"},
      77:{text:"Snow grains",icon:"‚ùÑÔ∏è"},
      80:{text:"Rain showers",icon:"üå¶Ô∏è"},
      81:{text:"Rain showers",icon:"üå¶Ô∏è"},
      82:{text:"Violent showers",icon:"‚õàÔ∏è"},
      85:{text:"Snow showers",icon:"üå®Ô∏è"},
      86:{text:"Heavy snow showers",icon:"üå®Ô∏è"},
      95:{text:"Thunderstorm",icon:"‚õàÔ∏è"},
      96:{text:"Thunderstorm + hail",icon:"‚õàÔ∏èüßä"},
      99:{text:"Thunderstorm + hail",icon:"‚õàÔ∏èüßä"},
    };

    // ---------- Elements ----------
    const statusEl = document.getElementById("status");
    const input = document.getElementById("cityInput");
    const searchBtn = document.getElementById("searchBtn");
    const clearBtn = document.getElementById("clearBtn");
    const locBtn = document.getElementById("locBtn");

    const unitBtn = document.getElementById("unitBtn");
    const unitLabel = document.getElementById("unitLabel");

    const placeNameEl = document.getElementById("placeName");
    const updatedAtEl = document.getElementById("updatedAt");
    const tzNowEl = document.getElementById("tzNow");

    const heroBox = document.getElementById("heroBox");
    const weatherIconEl = document.getElementById("weatherIcon");
    const tempNowEl = document.getElementById("tempNow");
    const weatherTextEl = document.getElementById("weatherText");
    const humidityNowEl = document.getElementById("humidityNow");
    const windNowEl = document.getElementById("windNow");
    const coordsNowEl = document.getElementById("coordsNow");
    const forecastGrid = document.getElementById("forecastGrid");
    const recentChips = document.getElementById("recentChips");

    // ---------- State ----------
    let unit = localStorage.getItem("unit") || "C"; // "C" or "F"
    unitLabel.textContent = unit === "C" ? "¬∞C" : "¬∞F";

    const RECENT_KEY = "recent_cities";
    const maxRecent = 8;

    function setStatus(msg){ statusEl.textContent = msg || ""; }

    function cToF(c){ return (c * 9/5) + 32; }
    function formatTemp(c){
      const v = unit === "C" ? c : cToF(c);
      return Math.round(v) + "¬∞";
    }
    function formatWindKmH(kmh){
      // keep km/h (simple)
      return Math.round(kmh) + " km/h";
    }

    function formatDay(dateStr, tz){
      const d = new Date(dateStr + "T00:00:00");
      const weekday = new Intl.DateTimeFormat(undefined,{weekday:"short", timeZone:tz}).format(d);
      const monthDay = new Intl.DateTimeFormat(undefined,{month:"short", day:"numeric", timeZone:tz}).format(d);
      return {weekday, monthDay};
    }

    // ---------- Map ----------
    const map = L.map('map', { worldCopyJump: true, zoomControl: true }).setView([20.5937, 78.9629], 3);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const marker = L.marker([20.5937, 78.9629]).addTo(map);

    map.on("click", (e) => {
      const {lat, lng} = e.latlng;
      loadByCoords(lat, lng);
    });

    // ---------- APIs ----------
    async function geocodeCity(city){
      const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=5&language=en&format=json`;
      const res = await fetch(url);
      if(!res.ok) throw new Error("Geocoding failed");
      const data = await res.json();
      if(!data.results || data.results.length === 0) return null;
      return data.results[0];
    }

    async function fetchWeather(lat, lon){
      const url =
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
        `&current=temperature_2m,relative_humidity_2m,wind_speed_10m,weather_code` +
        `&daily=temperature_2m_max,temperature_2m_min,weather_code` +
        `&forecast_days=7&timezone=auto`;
      const res = await fetch(url);
      if(!res.ok) throw new Error("Weather fetch failed");
      return res.json();
    }

    async function reverseGeocode(lat, lon){
      // For display name (Nominatim)
      const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`;
      const res = await fetch(url, { headers: { "Accept": "application/json" } });
      if(!res.ok) return null;
      return res.json();
    }

    // ---------- UI helpers ----------
    function setLoading(isLoading){
      const targets = [heroBox, document.getElementById("statHum"), document.getElementById("statWind"), document.getElementById("statCoords")];
      targets.forEach(el => el.classList.toggle("skeleton", isLoading));
      if(isLoading){
        forecastGrid.innerHTML = "";
        for(let i=0;i<6;i++){
          const box = document.createElement("div");
          box.className = "day skeleton";
          box.style.height = "120px";
          forecastGrid.appendChild(box);
        }
      }
    }

    function render(placeLabel, lat, lon, wx){
      const tz = wx.timezone || "auto";
      const cur = wx.current;

      placeNameEl.textContent = placeLabel || "Selected location";
      coordsNowEl.textContent = `${lat.toFixed(2)}, ${lon.toFixed(2)}`;
      tzNowEl.textContent = wx.timezone || "‚Äî";

      const updated = cur.time ? new Date(cur.time) : null;
      const updatedText = updated
        ? new Intl.DateTimeFormat(undefined,{dateStyle:"medium", timeStyle:"short", timeZone:tz}).format(updated)
        : "‚Äî";
      updatedAtEl.textContent = `Updated: ${updatedText}`;

      const info = WMO[cur.weather_code] || {text:"Unknown", icon:"üå°Ô∏è"};
      weatherIconEl.textContent = info.icon;
      weatherTextEl.textContent = info.text;

      tempNowEl.textContent = formatTemp(cur.temperature_2m) + (unit === "C" ? "C" : "F");
      humidityNowEl.textContent = `${Math.round(cur.relative_humidity_2m)}%`;
      windNowEl.textContent = formatWindKmH(cur.wind_speed_10m);

      // forecast
      const daily = wx.daily;
      forecastGrid.innerHTML = "";
      for(let i=0;i<daily.time.length;i++){
        const dateStr = daily.time[i];
        const tMax = daily.temperature_2m_max[i];
        const tMin = daily.temperature_2m_min[i];
        const code = daily.weather_code[i];
        const finfo = WMO[code] || {text:"Unknown", icon:"üå°Ô∏è"};
        const {weekday, monthDay} = formatDay(dateStr, tz);

        const el = document.createElement("div");
        el.className = "day";
        el.innerHTML = `
          <div class="dtop">
            <div class="dname">${weekday}</div>
            <div class="ddate">${monthDay}</div>
          </div>
          <div class="drow">
            <div class="dicon">${finfo.icon}</div>
            <div class="dtext">${finfo.text}</div>
          </div>
          <div class="pills">
            <span class="pill">Max: ${formatTemp(tMax)}${unit}</span>
            <span class="pill">Min: ${formatTemp(tMin)}${unit}</span>
          </div>
        `;
        forecastGrid.appendChild(el);
      }
    }

    // ---------- Recent searches ----------
    function getRecent(){
      try{ return JSON.parse(localStorage.getItem(RECENT_KEY) || "[]"); }
      catch{ return []; }
    }
    function setRecent(arr){
      localStorage.setItem(RECENT_KEY, JSON.stringify(arr.slice(0, maxRecent)));
      renderRecent();
    }
    function addRecent(city){
      const list = getRecent().filter(x => x.toLowerCase() !== city.toLowerCase());
      list.unshift(city);
      setRecent(list);
    }
    function renderRecent(){
      const list = getRecent();
      recentChips.innerHTML = "";
      if(list.length === 0){
        const t = document.createElement("div");
        t.style.color = "rgba(234,240,255,.55)";
        t.style.fontSize = "12px";
        t.textContent = "No recent searches yet.";
        recentChips.appendChild(t);
        return;
      }
      list.forEach(city=>{
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.textContent = city;
        chip.addEventListener("click", ()=> searchCity(city));
        recentChips.appendChild(chip);
      });
    }

    // ---------- Loaders ----------
    async function loadByCoords(lat, lon, label){
      setStatus("Loading weather‚Ä¶");
      setLoading(true);

      marker.setLatLng([lat, lon]);
      map.panTo([lat, lon], { animate:true, duration:0.5 });

      try{
        const wx = await fetchWeather(lat, lon);

        let placeLabel = label;
        if(!placeLabel){
          const rev = await reverseGeocode(lat, lon);
          if(rev && rev.display_name) placeLabel = rev.display_name;
        }

        render(placeLabel, lat, lon, wx);
        setStatus("Done ‚úÖ");
      }catch(e){
        console.error(e);
        setStatus("Failed to load weather. Try again.");
      }finally{
        setLoading(false);
        setTimeout(()=>{ if(statusEl.textContent === "Done ‚úÖ") setStatus(""); }, 1200);
      }
    }

    async function searchCity(city){
      const name = city.trim();
      if(!name) return setStatus("Type a city name first.");
      setStatus("Searching city‚Ä¶");
      setLoading(true);

      try{
        const place = await geocodeCity(name);
        if(!place){
          setStatus("City not found. Try another name.");
          return;
        }
        const label = [place.name, place.admin1, place.country].filter(Boolean).join(", ");
        addRecent(place.name);
        await loadByCoords(place.latitude, place.longitude, label);
      }catch(e){
        console.error(e);
        setStatus("Search failed. Please try again.");
      }finally{
        setLoading(false);
      }
    }

    // ---------- Buttons ----------
    searchBtn.addEventListener("click", ()=> searchCity(input.value));
    input.addEventListener("keydown", (e)=>{ if(e.key === "Enter") { e.preventDefault(); searchCity(input.value); }});

    clearBtn.addEventListener("click", ()=>{
      input.value = "";
      setStatus("Cleared.");
      setTimeout(()=>setStatus("Tip: Map pe click karo ‚Äî us location ka weather instantly aayega."), 900);
    });

    unitBtn.addEventListener("click", ()=>{
      unit = (unit === "C") ? "F" : "C";
      localStorage.setItem("unit", unit);
      unitLabel.textContent = unit === "C" ? "¬∞C" : "¬∞F";
      // Re-render by triggering a small refresh at marker location
      const p = marker.getLatLng();
      loadByCoords(p.lat, p.lng, placeNameEl.textContent);
    });

    locBtn.addEventListener("click", ()=>{
      if(!navigator.geolocation){
        setStatus("Geolocation not supported in this browser.");
        return;
      }
      setStatus("Getting your location‚Ä¶");
      navigator.geolocation.getCurrentPosition(
        (pos)=>{
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          loadByCoords(lat, lon, "My location");
        },
        ()=>{
          setStatus("Location permission denied. You can still click map / search city.");
        },
        { enableHighAccuracy:true, timeout: 8000 }
      );
    });

    // ---------- Init ----------
    renderRecent();
    // default load (India)
    loadByCoords(20.5937, 78.9629, "India");
  </script>
</body>
</html>
